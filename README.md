# ファイルサイズヒストグラムスクリプト

このリポジトリには、CSV で管理しているファイルサイズ情報を 2 の冪（2^n）で区切ったビンに分け、件数と合計サイズを可視化する R スクリプトが含まれています。各ビンに加えて、該当ビン以上の累積割合も棒グラフと折れ線で確認できます。

## 構成
- `accumulation_histgram.r`: CSV を読み込み、ビニングとグラフ描画を行うメインスクリプト。
- `data/`: サンプルデータ。既定では `data/test.csv` の `length` 列を読み込みます。
- `img/`: 出力画像ディレクトリ。`img/image.png` は出力イメージの参考例です。
- `.devcontainer/`: R 4.x 環境を再現するための Dev Container 設定。VS Code + Dev Containers 拡張機能と併用できます。

## 必要環境
- R（4.x で動作確認）
- R パッケージ: `showtext`（Dev Container 内では自動インストールされます）
- 日本語ラベルを正しく表示するために "Noto Sans CJK JP" フォントが必要です。フォントが利用できない場合は、スクリプト内の `jp_family` を任意のフォント名に置き換えてください。

Dev Container を利用する場合、`.devcontainer/devcontainer.json` で [rocker/r-ver:4](https://hub.docker.com/r/rocker/r-ver) イメージを取得し、必要なパッケージをセットアップします。

## 使い方
1. 入力 CSV に対象列（既定では `length`）が含まれていることを確認します。別のファイルや列を使う場合は、`accumulation_histogram.r` 冒頭の `csv_path` と `col_name` を変更してください。
2. リポジトリ直下のRのREPL環境でスクリプトを実行します(Rファイル内でctrl+shift+Enterでも可)。
   ```bash
   source("accumulation_histogram.r")
   ```
3. スクリプトは非数値・欠損・負の値を除去し、残りを 2 の冪で定めたビンに分類します。その上で次の 2 つのグラフを生成します。
   - 1 ビンあたりの件数と、`≥ 2^n` の累積件数割合
   - 1 ビンあたりの合計サイズと、`≥ 2^n` の累積サイズ割合
4. 出力画像は `img/` ディレクトリに `dist_2exp_bars_<DATE>.png`（`DATE` は `YYYYMMDD` 形式）で保存されます。描画完了後、スクリプトは絶対パスを標準出力に表示します。

## カスタマイズ
- データの差し替え: `csv_path` と `col_name` を変更して別の CSV・列に対応できます。
- 出力先の変更: `img_dir` を書き換えることで保存先ディレクトリを変更できます。
- フォントの変更: `jp_family` をお手元のフォントに置き換えることで、別フォントでの描画が可能です。日本語ラベルを表示する場合は `showtext` を有効のまま利用してください。

## トラブルシューティング
- `length 列に有効なデータがありません。` と表示される場合は、CSV のパスと列名が正しいか、非負の数値が含まれているかを確認してください。
- 日本語ラベルが文字化けする場合は、"Noto Sans CJK JP" など対応フォントをインストールするか、スクリプト内のフォント設定を変更してください。
